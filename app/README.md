# COMP1786 Lecture 6: Android Communication Firebase

- Mobile and web app development platform
- Includes a number of products including a database
- Stores data on Firebase cloud, but synchronises data across iOS, Android and web services
- The database is gaining popularity as a database for Android apps

![img.png](img.png)

![img_1.png](img_1.png)

![img_2.png](img_2.png)

Create an Android project named BooksFirebaseapp

![img_3.png](img_3.png)

Configure Firebase to use Realtime database

![img_4.png](img_4.png)

![img_5.png](img_5.png)

![img_6.png](img_6.png)

Click on `Add Project`

![img_7.png](img_7.png)

Provide Project Name

![img_8.png](img_8.png)

Disable Google Analytics

![img_9.png](img_9.png)

You will be connected to Firebase

![img_10.png](img_10.png)

Add references to your Android project

![img_11.png](img_11.png)

Go to https://console.firebase.google.com/
Select your project, then create Realtime database

![img_15.png](img_15.png)

Choose the location for Realtime database

![img_12.png](img_12.png)

For now, choose `Test mode`

![img_13.png](img_13.png)

Create the `MainActivity` layout

![img_14.png](img_14.png)

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
  xmlns:android="http://schemas.android.com/apk/res/android"
  xmlns:app="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools"
  android:id="@+id/main" android:layout_width="match_parent" android:layout_height="match_parent"
  tools:context=".MainActivity">

  <Button android:id="@+id/add_book" android:layout_width="wrap_content"
    android:layout_height="wrap_content" android:layout_marginStart="28dp"
    android:layout_marginTop="32dp" android:text="Add Book"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintTop_toBottomOf="@+id/priceText" />

  <Button android:id="@+id/view_book" android:layout_width="wrap_content"
    android:layout_height="wrap_content" android:layout_marginTop="32dp"
    android:layout_marginEnd="32dp" android:text="View Book"
    app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintTop_toBottomOf="@+id/priceText" />

  <EditText android:id="@+id/bookTitleText" android:layout_width="wrap_content"
    android:layout_height="wrap_content" android:layout_marginTop="32dp" android:ems="10"
    android:hint="Enter Book Title" android:inputType="text"
    app:layout_constraintEnd_toEndOf="parent" app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintTop_toTopOf="parent" />

  <EditText android:id="@+id/isbnText" android:layout_width="wrap_content"
    android:layout_height="wrap_content" android:layout_marginTop="32dp" android:ems="10"
    android:hint="Enter ISBN " android:inputType="text" app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintTop_toBottomOf="@+id/bookTitleText" />

  <EditText android:id="@+id/priceText" android:layout_width="wrap_content"
    android:layout_height="wrap_content" android:layout_marginTop="32dp" android:ems="10"
    android:hint="Enter Price" android:inputType="text" app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintTop_toBottomOf="@+id/isbnText" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

Create Book class to contain info. about a book

```java
public class Book {
  private String bookTitle;
  private String bookISBN;
  private float bookPrice;

  private String key; // hold the unique value generated by Firebase

  // Getter for bookTitle
  public String getBookTitle() {
    return bookTitle;
  }

  // Setter for bookTitle
  public void setBookTitle(String bookTitle) {
    this.bookTitle = bookTitle;
  }

  // Getter for bookISBN
  public String getBookISBN() {
    return bookISBN;
  }

  // Setter for bookISBN
  public void setBookISBN(String bookISBN) {
    this.bookISBN = bookISBN;
  }

  // Getter for bookPrice
  public float getBookPrice() {
    return bookPrice;
  }

  // Setter for bookPrice
  public void setBookPrice(float bookPrice) {
    this.bookPrice = bookPrice;
  }

  // Getter for key
  public String getKey() {
    return key;
  }

  // Setter for key
  public void setKey(String key) {
    this.key = key;
  }
}
```

In the `MainActivity.java`, follow this code below

```java
public class MainActivity extends AppCompatActivity {

  // Remember to change your Database URl here
  private final String DATABASE_URL = "https://comp1786-l6-firebase-default-rtdb.asia-southeast1.firebasedatabase.app/";
  FirebaseDatabase database;
  private EditText etTitle, etISBN, etPrice;
  private Button btnAddBook, btnViewBooks;

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    EdgeToEdge.enable(this);
    setContentView(R.layout.activity_main);
    ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -> {
      Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
      v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
      return insets;
    });

    etTitle = findViewById(R.id.bookTitleText);
    etISBN = findViewById(R.id.isbnText);
    etPrice = findViewById(R.id.priceText);
    btnAddBook = findViewById(R.id.add_book);
    btnViewBooks = findViewById(R.id.view_book);

    // NOTE: Reference to your Realtime database
    database = FirebaseDatabase.getInstance(DATABASE_URL);


    btnAddBook.setOnClickListener(new View.OnClickListener() {
      @Override
      public void onClick(View v) {
        Book b = new Book();
        b.setBookTitle(etTitle.getText().toString());
        b.setBookISBN(etISBN.getText().toString());
        b.setBookPrice(Float.parseFloat(etPrice.getText().toString()));
        addBook(b);
      }
    });

    btnViewBooks.setOnClickListener(new View.OnClickListener() {
      @Override
      public void onClick(View v) {

      }
    });


  }

  private boolean addBook(Book b) {
    try {
      DatabaseReference myRef = database.getReference("books");
      myRef
          .push()
          .setValue(b)
          .addOnSuccessListener(new OnSuccessListener<Void>() {
            @Override
            public void onSuccess(Void unused) {
              Toast.makeText(
                  MainActivity.this,
                  "Book added successfully",
                  Toast.LENGTH_SHORT
              ).show();
            }
          })
          .addOnFailureListener(new OnFailureListener() {
            @Override
            public void onFailure(@NonNull Exception e) {
              // Log the error for debugging
              Log.e("MainActivity", "Error adding book", e);
              Toast.makeText(
                  MainActivity.this,
                  "Error adding book",
                  Toast.LENGTH_SHORT
              ).show();
            }
          });
      return true;
    } catch (Exception e) {
      Log.e("MainActivity", "Error adding book", e);
      return false;
    }
  }
}
```

Test the Add button

![img_16.png](img_16.png)

Create BookListActivity to display a list of books
The BookListActivity uses RecyclerView

![img_17.png](img_17.png)

Create an item_book template for RecyclerView

![img_18.png](img_18.png)

Design BookListActivity to add RecyclerView

![img_19.png](img_19.png)

Create BookAdapter class

![img_20.png](img_20.png)

Create BookViewHolder class inside BookAdapter class

![img_21.png](img_21.png)

Add these attributes to BookListActivity class

![img_22.png](img_22.png)

Add a function getData() to BookListActivity class

![img_23.png](img_23.png)

Modify the function onCreate() of BookListActivity class

![img_24.png](img_24.png)

Click View Books button

![img_25.png](img_25.png)